# RetroAchievements Data Fetcher

A .NET console application designed to fetch game and console data from the RetroAchievements.org API. It stores the retrieved information in both human-readable JSON and efficient MessagePack binary formats, making it suitable for integration into other applications that require a local cache of RetroAchievements data.

## Table of Contents

*   [Features](#features)
*   [Prerequisites](#prerequisites)
*   [Getting Started](#getting-started)
    *   [Build the Project](#build-the-project)
*   [Usage](#usage)
    *   [Fetch Mode (Default)](#fetch-mode-default)
    *   [Conversion Mode](#conversion-mode)
*   [Configuration](#configuration)
*   [Output Files](#output-files)
*   [Data Models](#data-models)
*   [Dependencies](#dependencies)
*   [License](#license)

## Features

*   **Fetch Console List**: Retrieves a list of all consoles supported by RetroAchievements.
*   **Fetch Game List**: Gathers detailed game information, including achievements, for all active game systems.
*   **Multiple Output Formats**: Saves fetched data in:
    *   `all_ra_games.json`: Indented JSON for easy readability and debugging.
    *   `all_ra_games.dat`: MessagePack binary format for compact storage and fast deserialization.
*   **JSON to MessagePack Conversion**: Allows converting an existing JSON game data file into its MessagePack equivalent.
*   **Interactive Setup**: Guides the user through entering their RetroAchievements API credentials if not already configured.
*   **Rate Limiting**: Includes a small delay between API calls to avoid hitting rate limits.
*   **Console Logging**: Provides clear, color-coded feedback on the fetching process.

## Prerequisites

Before you begin, ensure you have the following:

*   **.NET SDK 10.0 or newer**: The application is built with C# 14 and targets .NET 10.0.
*   **RetroAchievements.org Account**: You need an account to generate an API key.
*   **RetroAchievements Web API Key**: Obtain your API key from your RetroAchievements.org profile settings.

## Getting Started

1.  **Clone the repository**:
    ```bash
    git clone https://github.com/your-repo/CSharp_SimpleLauncher.git
    cd CSharp_SimpleLauncher/Tools/RetroAchievements.DataFetcher
    ```

### Build the Project

Navigate to the project directory and build the application:

```bash
dotnet build --configuration Release
# Or publish for a self-contained executable:
dotnet publish --configuration Release --self-contained true --runtime win-x64 -p:PublishSingleFile=true
```

The executable will be found in `bin/Release/net8.0/publish/` (or similar, depending on your target framework and runtime).

## Usage

The tool operates in two primary modes: **Fetch Mode** (default) and **Conversion Mode**.

### Fetch Mode (Default)

This mode fetches data directly from the RetroAchievements API.

1.  **Run the application**:
    ```bash
    # From the project directory
    dotnet run

    # Or using the built executable
    ./bin/Release/net8.0/RetroAchievements.DataFetcher.exe
    ```

2.  **API Key Setup**:
    *   If `settings.xml` does not exist or is empty, you will be prompted to enter your RetroAchievements username and Web API Key.
    *   The tool will save these credentials to `settings.xml` for future use.
    *   If `settings.xml` exists, it will display your current username and ask if you want to update credentials.

3.  **Data Fetching**:
    *   The application will proceed to fetch console IDs, then iterate through active game systems to retrieve their respective game lists.
    *   Progress and status messages will be displayed in the console.

4.  **Output**: Upon successful completion, `all_ra_games.json` and `all_ra_games.dat` will be created in the application's directory. A `consoles.txt` file will also be generated.

### Conversion Mode

This mode allows you to convert an existing JSON file containing game data (e.g., `all_ra_games.json` generated by this tool) into the MessagePack binary format.

1.  **Run with a JSON file argument**:
    ```bash
    # From the project directory
    dotnet run -- "path/to/your_games.json"

    # Or using the built executable
    ./bin/Release/net8.0/RetroAchievements.DataFetcher.exe "path/to/your_games.json"
    ```
    Replace `"path/to/your_games.json"` with the actual path to your JSON file.

2.  **Output**: A new MessagePack file with the same name as the input JSON but with a `.dat` extension (e.g., `your_games.dat`) will be created in the same directory as the input JSON file.

## Configuration

The application uses an `settings.xml` file to store your RetroAchievements API credentials.

**`settings.xml` example:**

```xml
<?xml version="1.0" encoding="utf-8"?>
<RaSettings>
    <Username>your_username</Username>
    <WebApiKey>your_api_key</WebApiKey>
</RaSettings>
```

*   **`Username`**: Your RetroAchievements.org username.
*   **`WebApiKey`**: Your personal Web API Key, found in your RetroAchievements.org profile settings under "API Key".

If this file is missing or contains invalid credentials, the application will prompt you to enter them interactively and then save them to this file.

## Output Files

The following files are generated in the application's execution directory (or the directory of the input JSON for conversion mode):

*   **`consoles.txt`**: A plain text file listing all fetched console IDs and their names.
    ```
    001: NES
    002: SNES
    ...
    ```
*   **`all_ra_games.json`**: A JSON file containing a list of `GameInfo` objects for all games with achievements on active game systems. This file is human-readable and indented.
*   **`all_ra_games.dat`**: A binary file containing the same `GameInfo` list, serialized using MessagePack. This format is highly efficient for storage and deserialization in applications.
*   **`[input_file_name].dat`**: (Only in Conversion Mode) A MessagePack binary file converted from the specified input JSON file.

## Data Models

The application uses the following C# classes to structure the fetched data:

*   **`ConsoleInfo.cs`**: Represents a RetroAchievements console.
    ```csharp
    public class ConsoleInfo
    {
        public int Id { get; set; }
        public required string Name { get; set; }
        public string? IconUrl { get; set; }
        public bool Active { get; set; }
        public bool IsGameSystem { get; set; }
    }
    ```
*   **`GameInfo.cs`**: Represents a game with achievements.
    ```csharp
    public class GameInfo
    {
        public int Id { get; set; }
        public required string Title { get; set; }
        public int ConsoleId { get; set; }
        public required string ConsoleName { get; set; }
        public required string ImageIcon { get; set; }
        public int NumAchievements { get; set; }
        public int Points { get; set; }
        public required string DateModified { get; set; }
        public List<string> Hashes { get; set; } = [];
    }
    ```
*   **`RaSettings.cs`**: Stores user credentials for the API.
    ```csharp
    public class RaSettings
    {
        public string Username { get; set; } = string.Empty;
        public string WebApiKey { get; set; } = string.Empty;
    }
    ```

## Dependencies

This project uses the following NuGet package:

*   **`MessagePack`**: For efficient binary serialization/deserialization.
