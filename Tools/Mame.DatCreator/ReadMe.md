# MAME DAT Creator Utility

## Overview

The MAME DAT Creator Utility is a simple WPF application designed to merge the official MAME full driver list XML with the various MAME software list XMLs (found in the `hash` folder). The primary goal is to create a single, unified `.dat` file (and an accompanying XML) that contains all unique machine entries, prioritizing the full driver list where duplicates exist. This can be incredibly useful for frontends, emulators, or other tools that require a comprehensive and consolidated list of all MAME-supported games and software.

## Features

*   **Merge MAME Full Driver List:** Processes the `mame.xml` (or similar) file containing all MAME drivers.
*   **Merge MAME Software Lists:** Scans a specified MAME `hash` folder and processes all `*.xml` files within it (e.g., `nes.xml`, `snes.xml`, `megadriv.xml`).
*   **Prioritized Merging:** Entries from the MAME full driver list take precedence over entries from software lists if a machine with the same name exists in both.
*   **Output Formats:** Generates two output files:
    *   An XML file (`.xml`) with the merged machine names and descriptions.
    *   A binary DAT file (`.dat`) serialized using [MessagePack](https://github.com/MessagePack-CSharp/MessagePack-CSharp) for efficient storage and quick loading in other applications.
*   **User-Friendly GUI:** A straightforward WPF interface for selecting input files/folders and monitoring the process.
*   **Asynchronous Processing:** The merging process runs asynchronously to keep the UI responsive.
*   **Detailed Logging:** Provides real-time progress and error logging directly within the application window.

## How to Use

1.  **Download/Build:**
    *   Download the latest release from the [Releases page](https://github.com/yourusername/CSharp_SimpleLauncher/releases) (if available).
    *   Alternatively, clone this repository and build the project in Visual Studio (see "Building from Source" below).
2.  **Run the Application:** Execute `Mame.DatCreator.exe`.
3.  **Step 1: Select MAME Full Driver XML:**
    *   Click the "Browse..." button next to "MAME Full Driver XML".
    *   Navigate to and select your `mame.xml` file. This file is typically generated by running MAME with the command `mame -listxml > mame.xml`.
4.  **Step 2: Select MAME Hash Folder:**
    *   Click the "Browse..." button next to "MAME Hash Folder (Software Lists)".
    *   Navigate to and select your MAME `hash` folder (e.g., `MAME_ROOT/hash`). This folder contains XML files like `nes.xml`, `snes.xml`, `megadriv.xml`, etc., which define the software lists.
5.  **Step 3: Select Output File Location:**
    *   Click the "Browse..." button next to "Output File Location".
    *   Choose a location and provide a filename for your merged XML file (e.g., `merged_mame.xml`). The application will automatically create a corresponding `.dat` file with the same base name in the same directory.
6.  **Create DAT Files:**
    *   Click the "Create DAT Files" button.
    *   Monitor the "Process Log" for real-time progress, warnings, and any errors.
    *   A success message box will appear upon completion.

## Requirements

*   **Operating System:** Windows 7 or newer.
*   **.NET Runtime:** .NET 10 runtime.
*   **MAME XML Files:**
    *   A `mame.xml` full driver list XML, available on the MAME website.
    *   The `hash` folder from your MAME installation, containing software list XMLs.

## Building from Source

1.  **Clone the repository:**
    ```bash
    git clone https://github.com/yourusername/CSharp_SimpleLauncher.git
    cd CSharp_SimpleLauncher/Tools/Mame.DatCreator
    ```
2.  **Open in Visual Studio:** Open the `Mame.DatCreator.csproj` file in Visual Studio (2022 or newer).
3.  **Restore NuGet Packages:** Visual Studio should automatically restore the `MessagePack` NuGet package. If not, right-click the project in Solution Explorer and select "Manage NuGet Packages...", then "Restore".
4.  **Build:** Build the project (Build -> Build Solution). The executable will be found in the `bin/Debug` or `bin/Release` folder, depending on your build configuration.

## Technical Details

The application leverages .NET's XML parsing capabilities and asynchronous programming for efficient processing:

*   **`MameFullProcessor.cs`:** Responsible for parsing the main MAME full driver XML (`mame.xml`). It extracts `machine` elements, taking their `name` attribute and `description` element to create `MachineInfo` objects.
*   **`MameSoftwareProcessor.cs`:** Scans the specified `hash` folder. For each `*.xml` file found, it parses `software` elements, extracting their `name` attribute and `description` element. It utilizes `Parallel.ForEach` to process multiple software list XMLs concurrently, improving performance.
*   **`DatCreatorLogic.cs`:** Orchestrates the entire merging process.
    *   It first loads all machines from the full driver list.
    *   Then, it loads all software entries from the hash folder.
    *   A `Dictionary<string, MachineInfo>` is used to store unique machines, with entries from the full driver list taking priority over software list entries if a name conflict occurs.
    *   The final list of unique machines is sorted alphabetically by `MachineName`.
    *   The sorted list is then saved as a new XML file and a binary `.dat` file.
*   **`MachineInfo.cs`:** A simple Plain Old C# Object (POCO) model class to hold `MachineName` and `Description`. It is decorated with `[MessagePackObject]` and `[Key(n)]` attributes to enable efficient binary serialization using the MessagePack library.
*   **`WpfLogger.cs`:** Provides a logging mechanism that updates the `TextBox` in the WPF UI, ensuring thread-safe operations by dispatching updates to the UI thread.

## Dependencies

*   **[MessagePack for C#](https://github.com/MessagePack-CSharp/MessagePack-CSharp)** (NuGet package): Used for high-performance binary serialization of the `.dat` file.
